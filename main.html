<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Wordsearch by Nika Shum</title>
  <meta name="viewport" content="width=960, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent !important;
      font-family: 'Orbitron', Arial, sans-serif;
      width: 100vw; height: 100vh;
    }
    #container {
      display: flex;
      gap: 30px;
      align-items: flex-start;
      justify-content: center;
      height: 100vh;
      width: 100vw;
    }
    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
      background: transparent;
    }
    .cell {
      width: 45px;
      height: 45px;
      background: var(--cell-bg, rgba(0,0,0,0.5));
      border: 2px solid var(--main-color, #00ffff);
      color: var(--main-color, #00ffff);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      user-select: none;
      cursor: pointer;
      transition: 0.3s;
      border-radius: 10px;
      box-shadow: 0 0 8px var(--main-color, #00ffff);
      position: relative;
      overflow: hidden;
    }
    .cell.selected {
      background: var(--main-color, #00ffff);
      color: #000;
      box-shadow: 0 0 24px var(--main-color, #00ffff), 0 0 50px #fff4 inset;
    }
    .cell.correct {
      background: #2ecc71;
      color: #fff;
      animation: foundAnim 0.5s;
      box-shadow: 0 0 16px #2ecc71, 0 0 50px #fff4 inset;
    }
    .cell.error {
      background: #e74c3c;
      color: #fff;
      animation: errorAnim 0.3s;
      box-shadow: 0 0 12px #e74c3c, 0 0 30px #fff4 inset;
    }
    @keyframes errorAnim {
      0% { box-shadow: 0 0 12px #e74c3c, 0 0 10px #fff4 inset;}
      100% { box-shadow: 0 0 2px #e74c3c, 0 0 0px #fff4 inset;}
    }
    @keyframes foundAnim {
      0% { filter: brightness(1.6);}
      100% { filter: brightness(1);}
    }
    /* Magic style - glossy */
    .cell.glossy::after {
      content: "";
      display: block;
      position: absolute;
      left: 6px; top: 6px;
      width: 32px; height: 12px;
      border-radius: 50%;
      background: linear-gradient(90deg, #fff8, #fff2 70%, transparent 100%);
      opacity: 0.7;
      pointer-events: none;
      animation: glossAnim 2s infinite alternate;
    }
    @keyframes glossAnim {
      0% { opacity: 0.7; }
      100% { opacity: 0.95; }
    }
    /* Sparkle magic */
    .sparkle {
      position: absolute;
      width: 10px; height: 10px;
      pointer-events: none;
      border-radius: 50%;
      background: radial-gradient(circle,#fff,#6ff,#0ff 70%,transparent 100%);
      opacity: 0.8;
      animation: sparkle-fly 0.7s cubic-bezier(.4,1.8,.68,.98) forwards;
    }
    @keyframes sparkle-fly {
      0% {transform: scale(0.2);}
      80% {transform: scale(1.4);}
      100% {opacity: 0; transform: translateY(-60px) scale(0.4);}
    }
    /* Kids style */
    .kids {
      --main-color: #ffbb00;
      --cell-bg: #ffeccc;
    }
    /* Pastel style */
    .pastel {
      --main-color: #ffb6d6;
      --cell-bg: #fff7fa;
    }
    /* Neon style */
    .neon {
      --main-color: #00ffff;
      --cell-bg: rgba(0,0,0,0.6);
    }
    /* Magic style */
    .magic {
      --main-color: #97faff;
      --cell-bg: #21222f;
      animation: magicBg 3s linear infinite alternate;
    }
    @keyframes magicBg {
      0% { filter: brightness(1) hue-rotate(0deg);}
      100% { filter: brightness(1.1) hue-rotate(20deg);}
    }
    #wordsList {
      list-style: none;
      padding: 10px 12px;
      margin: 0;
      background: rgba(0,0,0,0.18);
      border-radius: 10px;
      border: 2px solid var(--main-color, #00ffff);
      max-height: 90vh;
      min-width: 120px;
      color: var(--main-color, #00ffff);
      font-size: 18px;
    }
    #wordsList li {
      margin-bottom: 8px;
      padding: 3px 0;
      border-bottom: 1px solid var(--main-color, #00ffff);
      transition: 0.2s;
    }
    #wordsList li.found {
      text-decoration: line-through;
      color: #aaa;
      opacity: 0.8;
    }
    #messageBox {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: rgba(0,0,0,0.9);
      padding: 30px 50px;
      border-radius: 20px;
      border: 3px solid var(--main-color, #00ffff);
      color: var(--main-color, #00ffff);
      font-size: 28px;
      font-weight: bold;
      text-align: center;
      display: none;
      z-index: 100;
      text-shadow: 0 0 24px var(--main-color,#00ffff80);
    }
    /* Hide logo and title in game! */
    #kgbLogo, #kgbHeader { display: none !important; }
  </style>
</head>
<body>
<div id="container">
  <div id="game">
    <div id="grid"></div>
    <div id="messageBox"></div>
  </div>
  <ul id="wordsList"></ul>
</div>
<audio id="clickSound" src="https://nikashum93.github.io/wordsearch/click.mp3" preload="auto"></audio>
<audio id="errorSound" src="https://nikashum93.github.io/wordsearch/error.mp3" preload="auto"></audio>
<audio id="winSound" src="https://nikashum93.github.io/wordsearch/win.mp3" preload="auto"></audio>
<script>
const params = new URLSearchParams(window.location.search);
const words = (params.get("words") || "HAT,KEY,LAMP").split(",").map(w=>w.trim()).filter(Boolean);
const winText = decodeURIComponent(params.get("winText") || "Ты нашёл все слова!");
const level = params.get("level") || "medium";
const caseType = params.get("case") || "uppercase";
const style = params.get("style") || "neon";
const alphabet = params.get("alphabet") || "latin";
const sparkles = params.get("sparkles") === "1";
const glossy = params.get("glossy") === "1";
const gridSize = 10;

const ALPHABETS = {
  latin: "abcdefghijklmnopqrstuvwxyz",
  cyrillic: "абвгдеёжзийклмнопрстуфхцчшщыэюя",
  french: "abcdefghijklmnopqrstuvwxyzéèàçôêâîûùëüï",
  german: "abcdefghijklmnopqrstuvwxyzäöüß",
  spanish: "abcdefghijklmnñopqrstuvwxyz",
  pinyin: "abcdefghijklmnopqrstuvwxyz",
  hiragana: "あいうえおかきくけこさしすせそたちつてとなにぬねの"
};
const alphabetLetters = ALPHABETS[alphabet] || ALPHABETS.latin;

function formatLetter(l) {
  return caseType === "lowercase" ? l.toLowerCase() : l.toUpperCase();
}

// Apply style
document.body.className = style;
document.getElementById('container').className = style;

// Grid logic
const grid = Array.from({length:gridSize},()=>Array(gridSize).fill(""));
function placeWords() {
  for (const wordRaw of words) {
    const word = (caseType === "lowercase"? wordRaw.toLowerCase() : wordRaw.toUpperCase());
    for (let attempt=0; attempt<80; attempt++) {
      const dirOptions = {
        easy: [[1,0],[0,1]],
        medium: [[1,0],[0,1],[1,1]],
        hard: [[1,0],[0,1],[1,1],[-1,1],[1,-1],[0,-1],[-1,0],[-1,-1]]
      }[level];
      const [dx,dy]=dirOptions[Math.floor(Math.random()*dirOptions.length)];
      const x=Math.floor(Math.random()*gridSize),y=Math.floor(Math.random()*gridSize);
      let fits = true;
      for (let i=0;i<word.length;i++) {
        const nx = x+dx*i, ny = y+dy*i;
        if (nx<0||ny<0||nx>=gridSize||ny>=gridSize) {fits=false;break;}
        if (grid[ny][nx]&&grid[ny][nx]!==word[i]){fits=false;break;}
      }
      if (fits) {
        for(let i=0;i<word.length;i++){
          const nx = x+dx*i, ny = y+dy*i;
          grid[ny][nx]=word[i];
        }
        break;
      }
    }
  }
  for (let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++)
    if (!grid[y][x]) grid[y][x]=formatLetter(alphabetLetters[Math.floor(Math.random()*alphabetLetters.length)]);
}

// State
let selection=[],foundWords=[],cells=[],isSelecting=false;
const gridEl=document.getElementById('grid'),wordsListEl=document.getElementById('wordsList'),messageBox=document.getElementById('messageBox');
const clickSound=document.getElementById('clickSound'),errorSound=document.getElementById('errorSound'),winSound=document.getElementById('winSound');
clickSound.volume=1; errorSound.volume=1; winSound.volume=1;

// Sparkle effect
function spawnSparkle(cell) {
  if (!sparkles) return;
  for (let i=0;i<4+Math.floor(Math.random()*2);i++) {
    const s=document.createElement('div');
    s.className='sparkle';
    s.style.left = (cell.offsetLeft+18+Math.random()*10)+'px';
    s.style.top = (cell.offsetTop+18+Math.random()*10)+'px';
    s.style.background = `radial-gradient(circle at 60% 40%,#fff,#${Math.floor(Math.random()*16777215).toString(16)} 80%,transparent 100%)`;
    gridEl.appendChild(s);
    setTimeout(()=>s.remove(), 650+Math.random()*150);
  }
}

function renderGrid() {
  gridEl.innerHTML = "";
  cells=[];
  for (let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++) {
    const cell=document.createElement('div');
    cell.className='cell'+(glossy?' glossy':'');
    cell.textContent=grid[y][x];
    cell.dataset.x=x;cell.dataset.y=y;
    cell.addEventListener('mousedown',startSelect);
    cell.addEventListener('mouseenter',overSelect);
    cell.addEventListener('mouseup',endSelect);
    cells.push(cell);
    gridEl.appendChild(cell);
  }
}
function renderWords() {
  wordsListEl.innerHTML="";
  words.forEach(word=>{
    const li=document.createElement("li");
    li.textContent=caseType==="lowercase"?word.toLowerCase():word.toUpperCase();
    if(foundWords.includes(li.textContent)) li.classList.add("found");
    wordsListEl.appendChild(li);
  });
}
function clearSelection(error=false){
  selection.forEach(cell=>{
    cell.classList.remove("selected");
    if(error) {
      cell.classList.add("error");
      errorSound.currentTime=0; errorSound.play();
      setTimeout(()=>cell.classList.remove("error"),320);
    }
  }); selection=[];
}
function getWordFromSelection() {
  return selection.map(c=>c.textContent).join('');
}
function startSelect(e){
  isSelecting=true;
  selection=[e.target];
  e.target.classList.add('selected');
  clickSound.currentTime=0; clickSound.play();
}
function overSelect(e){
  if(!isSelecting) return;
  const last=selection[selection.length-1];
  if(e.target===last||selection.includes(e.target)) return;
  selection.push(e.target);
  e.target.classList.add('selected');
  clickSound.currentTime=0; clickSound.play();
}
function endSelect(){
  isSelecting=false;
  const selectedWord=getWordFromSelection();
  const valid=words.some(word=>(caseType==="lowercase"?word.toLowerCase():word.toUpperCase())===selectedWord);
  if(valid) {
    selection.forEach(c=>{
      c.classList.remove('selected');
      c.classList.add('correct');
      if (sparkles) spawnSparkle(c);
    });
    foundWords.push(selectedWord);
    renderWords();
    if(foundWords.length===words.length){
      setTimeout(()=>{
        winSound.currentTime=0; winSound.play();
        messageBox.innerText=winText;
        messageBox.style.display="block";
      },350);
    }
  } else {
    clearSelection(true);
  }
  selection=[];
}
placeWords();
renderGrid();
renderWords();
document.addEventListener('mouseup',()=>isSelecting=false);
</script>
</body>
</html>
